import json,os

def get_postexploit_result(session_name):
    sensitive_pem_files = []
    other_sensitive_files = []
    software_list = []
    total_software_found = 0
    total_user_found = 0
    users_list = []
    
    # Lire les données depuis le fichier JSON
    with open(f'reports/{session_name}_session/{session_name}.json', 'r') as json_file:
        data = json.load(json_file)
    

    if 'ssh_connexion1' in data:
        ssh_connexion_data = data['ssh_connexion1']
        if 'ssh_sensitive_file' in ssh_connexion_data:
            sensitive_files_list_1 = ssh_connexion_data['ssh_sensitive_file'].get('sensistive_file', [])
            if sensitive_files_list_1:
                sensitive_pem_files.extend(sensitive_files_list_1[0])
                other_sensitive_files.extend(sensitive_files_list_1[1])

    if 'ssh_connexion1' in data:
        ssh_connexion_data = data['ssh_connexion1']
        if 'ssh_software_installed' in ssh_connexion_data:
            # Récupérer la liste des logiciels installés
            installed_software_list = ssh_connexion_data['ssh_software_installed'].get('installed_software', [])

            for software_info in installed_software_list:
                name = software_info.get('name', '')
                version = software_info.get('version', '')
                description = software_info.get('description', '')
                software_list.append({'name': name, 'version': version, 'description': description})
                total_software_found += 1


    if 'ssh_connexion1' in data:
        ssh_connexion_data = data['ssh_connexion1']
        if 'ssh_user_group' in ssh_connexion_data:
            ssh_user_group_data = ssh_connexion_data['ssh_user_group']
            user_accounts_list = ssh_user_group_data.get('user_accounts', [])

            for user_info in user_accounts_list:
                name = user_info.get('name', '') 
                users_list.append({'name': name})
                total_user_found += 1
    
    # Afficher les listes de fichiers pour vérification
    print("sensitive 1 : ", sensitive_pem_files)
    print("sensitive 2 : ", other_sensitive_files)
    print("Nombre total de logiciels trouvés:", total_software_found)
    print("Nombre total d'utilisateurs trouvés:", total_user_found)

    return sensitive_pem_files, other_sensitive_files, software_list, total_software_found, total_user_found, users_list
